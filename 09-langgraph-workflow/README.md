# 07 - LangGraph 工作流

本目录专注于 LangGraph 工作流的完整实现，包含状态管理、条件分支、工具调用和会话记忆等高级功能。

## 已实现的学习点

### 1. 基础工作流构建
- **文件**: `01_langgraph_workflow_chatbot.py`
- **内容**: 完整的 LangGraph 工作流实现，包含节点定义、状态管理和条件分支
- **示例**: 构建多节点聊天机器人工作流，支持工具调用和会话记忆
- **具体实现**:
  - 使用 `StateGraph` 构建工作流
  - 定义 `AgentState` 状态类管理工作流状态
  - 实现条件分支逻辑控制工作流走向

### 2. 状态管理与检查点
- **文件**: `01_langgraph_workflow_chatbot.py`
- **内容**: 使用 `MemorySaver` 实现状态持久化和检查点管理
- **示例**: 会话状态的保存和恢复，支持多轮对话
- **具体实现**:
  - 配置 `checkpointer` 启用状态持久化
  - 使用 `thread_id` 管理不同会话的状态
  - 实现状态恢复和连续性对话

### 3. 条件分支与路由
- **文件**: `01_langgraph_workflow_chatbot.py`
- **内容**: 基于工具调用和对话状态的智能路由
- **示例**: 自动检测是否需要调用工具，动态调整工作流路径
- **具体实现**:
  - 使用 `add_conditional_edges` 实现条件分支
  - 根据消息内容判断是否需要工具调用
  - 实现工具调用后的自动返回机制

### 4. 工具调用集成
- **文件**: `01_langgraph_workflow_chatbot.py`
- **内容**: 在 LangGraph 工作流中集成工具调用能力
- **示例**: 数学计算工具和日期查询工具
- **具体实现**:
  - 使用 `@tool` 装饰器定义工具
  - 通过 `bind_tools` 将工具绑定到 LLM
  - 使用 `ToolNode` 处理工具调用

### 5. 会话记忆管理
- **文件**: `01_langgraph_workflow_chatbot.py`
- **内容**: 实现多轮对话的会话记忆和上下文管理
- **示例**: 历史消息的存储、检索和自动清理
- **具体实现**:
  - 使用 `ChatMessageHistory` 管理会话历史
  - 实现历史消息的自动截断（最多10条）
  - 支持基于会话ID的记忆隔离

### 6. 错误处理与重试
- **文件**: `01_langgraph_workflow_chatbot.py`
- **内容**: 工作流执行过程中的异常处理和重试机制
- **示例**: LLM 调用失败、工具执行错误的优雅处理
- **具体实现**:
  - 配置 LLM 的 `max_retries` 和 `timeout`
  - 实现工具调用的异常捕获
  - 提供用户友好的错误信息

### 7. 交互式对话系统
- **文件**: `01_langgraph_workflow_chatbot.py`
- **内容**: 完整的交互式聊天机器人实现
- **示例**: 支持数学计算、日期查询的智能对话
- **具体实现**:
  - 实现交互式输入输出循环
  - 支持退出命令检测
  - 提供示例问题和引导

## 进阶学习点

### 1. 复杂工作流设计
- 多工作流编排与协调
- 工作流间的数据传递
- 并行执行与结果合并
- 工作流监控与调试

### 2. 高级状态管理
- 分布式状态存储
- 状态版本控制
- 状态快照与回滚
- 状态压缩与优化

### 3. 性能优化
- 工作流执行性能分析
- 缓存策略与优化
- 批量处理与流式处理
- 资源使用监控

### 4. 生产环境部署
- 容器化部署
- 水平扩展策略
- 监控与告警
- 日志与审计

### 5. 安全与权限
- 工作流权限控制
- 数据加密与保护
- 输入验证与过滤
- 安全审计日志

## 快速开始

### 环境配置
1. 复制 `.env.example` 为 `.env`
2. 配置 OpenAI API Key 和其他环境变量
3. 安装依赖：`pip install -r requirements.txt`

### 运行示例
```bash
python 01_langgraph_workflow_chatbot.py
```

### 示例对话
- "计算 123 加 456 等于多少？"
- "今天是几号？"
- "我想知道5乘以10的结果"

## 学习目标

通过本目录的学习，您将能够：
- 理解 LangGraph 的核心概念和工作原理
- 构建复杂的工作流应用
- 实现状态管理和条件分支
- 集成工具调用和外部服务
- 设计可扩展和可维护的工作流系统

## 进阶思考

1. 如何设计支持多租户的工作流系统？
2. 如何实现工作流的版本管理和灰度发布？
3. 如何监控工作流的执行性能和资源使用？
4. 如何设计容错和自愈的工作流？
5. 如何与其他 AI 组件（如向量数据库、知识图谱）集成？
6. 如何优化工作流的执行效率和响应时间？
