# 04 - 记忆能力 Demo（Memory）

本目录包含 LangChain 记忆能力的轻量化 Demo，涵盖核心概念和实际应用。

## ✅ 已实现的学习点

### 1. 聊天消息历史存储
- **文件**: `01_chat_message_history_demo.py`
- **内容**: 内存存储、文件存储、数据库存储、会话管理
- **示例**: 多会话聊天历史管理，支持不同存储后端
  - **具体实现**: 使用 `ChatMessageHistory` 类管理内存存储，`FileChatMessageHistory` 实现文件持久化，`RedisChatMessageHistory` 和 `SQLChatMessageHistory` 支持数据库存储，基于 `session_id` 的多会话支持

### 2. 实体记忆
- **文件**: `02_entity_memory_demo.py`
- **内容**: 实体提取、实体存储、实体检索、实体更新
- **示例**: 对话中实体信息提取和管理
  - **具体实现**: 通过自定义提示模板提取对话中的实体信息，使用字典存储实体数据，支持实体检索和动态更新，实现基于实体的上下文记忆

### 3. 摘要记忆
- **文件**: `03_summary_memory_demo.py`
- **内容**: 对话摘要生成、摘要存储、摘要检索、Token 优化
- **示例**: 长对话摘要压缩和检索
  - **具体实现**: 使用 LangChain 的摘要记忆机制自动生成对话摘要，减少历史消息的 Token 消耗，通过摘要检索快速获取对话关键信息

### 4. Token 压缩记忆
- **文件**: `03_token_compression_memory_demo.py`
- **内容**: Token 计数、消息压缩、智能截断、性能优化
- **示例**: 长对话历史智能压缩
  - **具体实现**: 使用 `tiktoken` 库进行 Token 计数，实现智能消息截断策略，当历史消息超过阈值时自动压缩，保持对话连贯性的同时优化性能

### 5. 有限历史记忆
- **文件**: `04_limited_history_memory_demo.py`
- **内容**: 消息数量限制、滑动窗口、内存优化、性能控制
- **示例**: 限制对话历史长度
  - **具体实现**: 自定义 `LimitedChatMessageHistory` 类实现消息数量限制，使用滑动窗口机制保持最新对话，防止内存溢出，优化系统性能

### 6. 键值记忆
- **文件**: `05_key_value_memory_demo.py`
- **内容**: 键值存储、自定义记忆类、结构化数据、灵活检索
- **示例**: 结合键值存储的智能记忆
  - **具体实现**: 继承 `BaseChatMessageHistory` 实现 `KeyValueChatMessageHistory` 类，结合消息历史和键值存储，支持结构化数据存储和灵活检索

### 7. 向量存储记忆
- **文件**: `06_vector_store_memory_demo.py`
- **内容**: 向量数据库、语义检索、相似度匹配、上下文理解
- **示例**: 基于语义的对话记忆检索
  - **具体实现**: 使用 FAISS 向量数据库存储对话内容，通过 `VectorStoreRetrieverMemory` 实现语义检索，基于相似度匹配找到相关历史对话，增强上下文理解能力

## 🚀 快速开始

1. **环境准备**：
   ```bash
   cd 04-memory
   pip install -r requirements.txt
   ```

2. **配置环境变量**：
   在 `.env` 文件中配置 OpenAI API 密钥和其他参数

3. **运行示例**：
   ```bash
   python 01_chat_message_history_demo.py
   python 02_entity_memory_demo.py
   python 06_vector_store_memory_demo.py
   ```

## 🎯 学习目标

通过本模块学习，你将掌握：
- LangChain 多种记忆机制的原理和使用
- 不同存储方案的优缺点和适用场景
- 记忆优化和性能调优技巧
- 实际项目中记忆系统的设计思路

## 💡 进阶思考

- 如何设计一个支持百万用户的高性能记忆系统？
- 记忆系统如何平衡准确性和性能？
- 在多轮对话中如何避免记忆污染？
- 如何实现跨会话的记忆共享？
- 记忆系统如何应对高并发场景下的性能挑战？
- 如何设计可扩展的记忆存储架构？
- 记忆系统如何保证数据的一致性和可靠性？
- 在不同业务场景下如何选择合适的记忆策略？
- 如何实现记忆系统的灰度发布和版本管理？
- 记忆系统如何与其他AI组件（如推理引擎、知识图谱）集成？

