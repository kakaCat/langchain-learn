# 05 - 结构化输出与数据验证（Structured Output & Validation）

本目录包含结构化输出与数据验证的轻量化 Demo，展示了如何使用 Pydantic 模型和验证规则实现复杂数据结构的标准化输出。

## ✅ 已实现的学习点

### 1. 结构化数据验证与模型定义
- **文件**: `01_structured_validation_demo.py`
- **内容**: Pydantic 模型定义、字段验证、自定义验证器、数据标准化
- **示例**: 内容数据模型验证、用户数据模型验证、字段约束和业务规则验证
  - **具体实现**: 使用 `ContentData` 和 `UserData` Pydantic 模型定义数据结构，通过 `Field` 设置字段约束，使用 `@validator` 装饰器实现自定义验证逻辑，包括标题标准化、邮箱格式验证、手机号验证、标签去重等

### 2. 验证规则引擎
- **文件**: `01_structured_validation_demo.py`
- **内容**: 通用验证规则、格式验证、长度验证、静态工具类设计
- **示例**: 邮箱格式验证、手机号验证、URL验证、内容长度验证
  - **具体实现**: 通过 `ValidationRule` 静态工具类提供通用的验证方法，包括正则表达式匹配邮箱、手机号、URL格式，以及内容长度范围验证

### 3. 数据转换与标准化
- **文件**: `01_structured_validation_demo.py`
- **内容**: 命名规范转换、文本标准化、时间戳格式化、数据格式统一
- **示例**: 蛇形命名与驼峰命名转换、文本标准化处理、时间戳格式化
  - **具体实现**: 通过 `DataConverter` 静态工具类提供数据转换方法，包括 `to_snake_case`、`to_camel_case` 命名转换，`normalize_text` 文本标准化，`format_timestamp` 时间戳格式化

### 4. 响应包装与场景适配
- **文件**: `01_structured_validation_demo.py`
- **内容**: API响应包装、缓存格式包装、场景化数据适配
- **示例**: API响应格式包装、缓存优化格式包装
  - **具体实现**: 通过 `ContentWrapper` 类提供不同场景下的数据包装方法，`wrap_for_api` 提供完整的API响应格式，`wrap_for_cache` 提供精简的缓存格式

### 5. 服务层封装与业务逻辑
- **文件**: `01_structured_validation_demo.py`
- **内容**: 内容服务封装、数据存储管理、搜索功能、异常处理
- **示例**: 内容创建、内容获取、内容搜索、错误处理
  - **具体实现**: 通过 `ContentService` 类封装业务逻辑，包括内容创建时的数据验证和存储，内容获取时的格式选择，内容搜索时的关键词匹配，以及完整的异常处理和错误响应

### 6. 综合演示与测试用例
- **文件**: `01_structured_validation_demo.py`
- **内容**: 完整功能演示、多种测试场景、数据转换展示、验证规则测试
- **示例**: 正常数据创建、验证失败处理、内容搜索、数据转换演示、验证规则测试
  - **具体实现**: `demo_structured_validation` 函数提供完整的演示流程，包括6个测试用例展示不同场景下的功能表现，从数据验证到转换再到包装的全流程演示

## 🚀 快速开始

### 环境准备
1. 安装依赖：`pip install pydantic`
2. 运行示例：`python 01_structured_validation_demo.py`

### 运行示例
- **结构化数据验证**：运行主程序查看完整验证流程
- **自定义验证规则**：测试邮箱、手机号、URL等格式验证
- **数据转换演示**：体验蛇形命名、驼峰命名转换

## 📝 学习目标
通过本模块，您将掌握：
- Pydantic 模型的基本使用方法
- 结构化数据验证与标准化
- 自定义验证规则的实现
- 数据转换和格式化的最佳实践

## 💡 进阶思考
- 如何扩展验证规则支持更多业务场景？
- 如何实现动态验证规则配置？
- 如何集成到现有的数据处理流程中？
- 如何设计可复用的验证规则组件？
- 如何优化大规模数据的验证性能？

## 🏗️ 架构设计模式
- **静态工具类模式** - ValidationRule、DataConverter 使用静态方法，提高性能
- **分层架构模式** - 清晰的模型层、工具层、服务层、包装层分离
- **数据包装模式** - ContentWrapper 针对不同场景（API、缓存）提供适配的数据格式
- **验证器模式** - 通过 @validator 装饰器实现字段级业务规则验证

## 🔧 实际应用场景
- **API 数据验证** - 确保输入数据的完整性和正确性
- **数据标准化** - 统一不同来源数据的格式规范
- **缓存优化** - 为缓存场景提供精简的数据结构
- **错误处理** - 提供清晰的验证失败信息和错误详情

## 🛠️ 技术栈
- **Pydantic** - 数据模型定义与验证
- **Python 类型提示** - 类型安全的数据结构
- **正则表达式** - 格式验证规则实现
- **静态工具类** - 可复用的验证和转换工具

## ✨ 项目特色
- **完整的验证流程** - 从模型定义到验证、转换、包装的全流程实现
- **多场景适配** - 支持API响应、缓存优化等不同场景的数据格式
- **清晰的错误处理** - 提供详细的验证失败信息和错误详情
- **可扩展架构** - 静态工具类设计便于扩展新的验证规则和转换方法
- **类型安全** - 充分利用Python类型提示确保数据结构的类型安全